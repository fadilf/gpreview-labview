<script>var rawData = {"TLD Position":{"Left":128,"Top":125},"TLD":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEkAAAAUCAMAAAD2veDHAAADAFBMVEX//////8z//5n//2b//zP//wD/zP//zMz/zJn/zGb/zDP/zAD/mf//mcz/mZn/mWb/mTP/mQD/Zv//Zsz/Zpn/Zmb/ZjP/ZgD/M///M8z/M5n/M2b/MzP/MwD/AP//AMz/AJn/AGb/ADP/AADM///M/8zM/5nM/2bM/zPM/wDMzP/MzMzMzJnMzGbMzDPMzADMmf/MmczMmZnMmWbMmTPMmQDMZv/MZszMZpnMZmbMZjPMZgDMM//MM8zMM5nMM2bMMzPMMwDMAP/MAMzMAJnMAGbMADPMAACZ//+Z/8yZ/5mZ/2aZ/zOZ/wCZzP+ZzMyZzJmZzGaZzDOZzACZmf+ZmcyZmZmZmWaZmTOZmQCZZv+ZZsyZZpmZZmaZZjOZZgCZM/+ZM8yZM5mZM2aZMzOZMwCZAP+ZAMyZAJmZAGaZADOZAABm//9m/8xm/5lm/2Zm/zNm/wBmzP9mzMxmzJlmzGZmzDNmzABmmf9mmcxmmZlmmWZmmTNmmQBmZv9mZsxmZplmZmZmZjNmZgBmM/9mM8xmM5lmM2ZmMzNmMwBmAP9mAMxmAJlmAGZmADNmAAAz//8z/8wz/5kz/2Yz/zMz/wAzzP8zzMwzzJkzzGYzzDMzzAAzmf8zmcwzmZkzmWYzmTMzmQAzZv8zZswzZpkzZmYzZjMzZgAzM/8zM8wzM5kzM2YzMzMzMwAzAP8zAMwzAJkzAGYzADMzAAAA//8A/8wA/5kA/2YA/zMA/wAAzP8AzMwAzJkAzGYAzDMAzAAAmf8AmcwAmZkAmWYAmTMAmQAAZv8AZswAZpkAZmYAZjMAZgAAM/8AM8wAM5kAM2YAMzMAMwAAAP8AAMwAAJkAAGYAADPuAADdAAC7AACqAACIAAB3AABVAABEAAAiAAARAAAA7gAA3QAAuwAAqgAAiAAAdwAAVQAARAAAIgAAEQAAAO4AAN0AALsAAKoAAIgAAHcAAFUAAEQAACIAABHu7u7d3d27u7uqqqqIiIh3d3dVVVVEREQiIiIREREAAAD7CIKZAAAA+ElEQVR4nOWUzQ2DMAyFgVsGyQbcGCLqDjBBOkQvwASoA0APlCW4cWMcXNtxVYLIoagXVAsFyzEffo+fqIPD0UVeQHw44AykpB6xnFTm05M1uKgxKbUUvN0wqXrYTa8idmZ3SOu2HdKl1RtSj4VSf08yqIZa1ABguamwNJeQsHzH3QxgTGpcOAuQ5Kjx+iffM21QnJConM7GDSQz8WmPRO5WhjQRgMZodW6EpES7ApgdibMAKS6uHinO2bs1iXZzJrksRFLD7NT1zuQU8EXw1KlJo3QmcRYisRNo7SyPhlvfjgM7XsB0I99Hyc7xtfyKtBz/Py3R/8QL3EYGaT4V94EAAAAASUVORK5CYII=","Structure to Diagram":[],"Diagram to Structure":[],"BD Color":"FFFFFF","TLD Bounds":{"Width":73,"Height":20}}</script><!DOCTYPE html>
<html>

<body>
    <script>
        if (typeof rawData === 'undefined') {
            var rawData = { "TLD Position": { "Left": 128, "Top": 125 }, "TLD": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEkAAAAUCAMAAAD2veDHAAADAFBMVEX//////8z//5n//2b//zP//wD/zP//zMz/zJn/zGb/zDP/zAD/mf//mcz/mZn/mWb/mTP/mQD/Zv//Zsz/Zpn/Zmb/ZjP/ZgD/M///M8z/M5n/M2b/MzP/MwD/AP//AMz/AJn/AGb/ADP/AADM///M/8zM/5nM/2bM/zPM/wDMzP/MzMzMzJnMzGbMzDPMzADMmf/MmczMmZnMmWbMmTPMmQDMZv/MZszMZpnMZmbMZjPMZgDMM//MM8zMM5nMM2bMMzPMMwDMAP/MAMzMAJnMAGbMADPMAACZ//+Z/8yZ/5mZ/2aZ/zOZ/wCZzP+ZzMyZzJmZzGaZzDOZzACZmf+ZmcyZmZmZmWaZmTOZmQCZZv+ZZsyZZpmZZmaZZjOZZgCZM/+ZM8yZM5mZM2aZMzOZMwCZAP+ZAMyZAJmZAGaZADOZAABm//9m/8xm/5lm/2Zm/zNm/wBmzP9mzMxmzJlmzGZmzDNmzABmmf9mmcxmmZlmmWZmmTNmmQBmZv9mZsxmZplmZmZmZjNmZgBmM/9mM8xmM5lmM2ZmMzNmMwBmAP9mAMxmAJlmAGZmADNmAAAz//8z/8wz/5kz/2Yz/zMz/wAzzP8zzMwzzJkzzGYzzDMzzAAzmf8zmcwzmZkzmWYzmTMzmQAzZv8zZswzZpkzZmYzZjMzZgAzM/8zM8wzM5kzM2YzMzMzMwAzAP8zAMwzAJkzAGYzADMzAAAA//8A/8wA/5kA/2YA/zMA/wAAzP8AzMwAzJkAzGYAzDMAzAAAmf8AmcwAmZkAmWYAmTMAmQAAZv8AZswAZpkAZmYAZjMAZgAAM/8AM8wAM5kAM2YAMzMAMwAAAP8AAMwAAJkAAGYAADPuAADdAAC7AACqAACIAAB3AABVAABEAAAiAAARAAAA7gAA3QAAuwAAqgAAiAAAdwAAVQAARAAAIgAAEQAAAO4AAN0AALsAAKoAAIgAAHcAAFUAAEQAACIAABHu7u7d3d27u7uqqqqIiIh3d3dVVVVEREQiIiIREREAAAD7CIKZAAAA+ElEQVR4nOWUzQ2DMAyFgVsGyQbcGCLqDjBBOkQvwASoA0APlCW4cWMcXNtxVYLIoagXVAsFyzEffo+fqIPD0UVeQHw44AykpB6xnFTm05M1uKgxKbUUvN0wqXrYTa8idmZ3SOu2HdKl1RtSj4VSf08yqIZa1ABguamwNJeQsHzH3QxgTGpcOAuQ5Kjx+iffM21QnJConM7GDSQz8WmPRO5WhjQRgMZodW6EpES7ApgdibMAKS6uHinO2bs1iXZzJrksRFLD7NT1zuQU8EXw1KlJo3QmcRYisRNo7SyPhlvfjgM7XsB0I99Hyc7xtfyKtBz/Py3R/8QL3EYGaT4V94EAAAAASUVORK5CYII=", "Structure to Diagram": [], "Diagram to Structure": [], "BD Color": "FFFFFF", "TLD Bounds": { "Width": 73, "Height": 20 } }
        }
    </script>
    <div id="container">
        <div id="top-level-diagram"></div>
    </div>
    <script>
        let structureMap = {}
        rawData["Structure to Diagram"].forEach(item => {
            structureMap[item.UID] = item["Diagram Group"]
        })
        let diagramMap = {}
        rawData["Diagram to Structure"].forEach(item => {
            diagramMap[item["Diagram UID"]] = item["Diagram Children"]
        })

        let structures = [];
        function traverseDiagram(diagramUID, parentPosition) {
            if (diagramUID in diagramMap) {
                return diagramMap[diagramUID].map(structureUID => traverseStructure(structureUID, parentPosition))
            } else {
                return []
            }
        }
        function traverseStructure(structureUID, parentPosition) {
            let structureData = structureMap[structureUID];
            let diagrams = []
            let currentPosition = {
                "top": structureData["Position"]["Top"],
                "left": structureData["Position"]["Left"]
            }
            structureData["Diagram Data"].forEach(diagram => {
                diagrams.push({
                    "image": diagram["Diagram Image"],
                    "structures": traverseDiagram(diagram["UID"], currentPosition)
                })
            })
            return {
                "top": structureData["Position"]["Top"] - parentPosition["top"],
                "left": structureData["Position"]["Left"] - parentPosition["left"],
                "width": structureData["Bounds"]["Width"],
                "height": structureData["Bounds"]["Height"],
                "diagrams": diagrams
            }
        }
        rawData["Structure to Diagram"].forEach(item => {
            let structureUID = item["UID"];
            if (item["Diagram Group"]["Is on TLD?"]) {
                structures.push(traverseStructure(structureUID, { "top": 0, "left": 0 }))
            }
        })

        function printStructures(structures) {
            let output = "";
            structures.forEach((structure) => {
                output += `<div class="structure" 
                style="top:${structure.top}px; left:${structure.left}px; width:${structure.width}px; height:${structure.height}px" 
                data-diagrams="${structure.diagrams.length}"
                data-index="0">`;
                structure.diagrams.forEach((diagram, index) => {
                    output += `<div class="diagram${(index == 0) ? ' visible' : ''}" 
                    style="background-image:url(${diagram.image}); width:${structure.width}px; height:${structure.height}px">`;
                    output += printStructures(diagram.structures);
                    output += '</div>';
                });
                output += `</div>`;
            });
            return output;
        }

        let bgLeft = rawData["TLD Position"]["Left"];
        let bgTop = rawData["TLD Position"]["Top"];
        let bgWidth = rawData["TLD Bounds"]["Width"];
        let bgHeight = rawData["TLD Bounds"]["Height"];
        let output = `<div style="left:${bgLeft}px;top:${bgTop}px;width:${bgWidth}px;height:${bgHeight}px;background-image:url(${rawData["TLD"]})"></div>` + printStructures(structures);
        document.querySelector("#top-level-diagram").innerHTML = output;
        document.body.style.backgroundColor = "#" + rawData["BD Color"];
        
        $container = document.querySelector("#container")
        if (bgLeft < 0) {
            $container.style.left = (bgLeft * -1) + "px";
        }
        if (bgTop < 0) {
            $container.style.top = (bgTop * -1) + "px";
        }

        document.querySelectorAll(".structure").forEach(structureElem => {
            structureElem.addEventListener("click", (event) => {
                event.stopPropagation()
                let diagrams = parseInt(structureElem.getAttribute("data-diagrams"));
                let oldIndex = parseInt(structureElem.getAttribute("data-index"));
                let newIndex = (oldIndex + 1) % diagrams;
                structureElem.children[oldIndex].classList.remove("visible")
                structureElem.children[newIndex].classList.add("visible")
                structureElem.setAttribute("data-index", newIndex)
            });

        })

    </script>
    <style>
        .structure {
            position: absolute;
            overflow-y: hidden;
            cursor: pointer;
        }

        .diagram {
            display: none;
        }

        .diagram.visible {
            display: block;
        }

        .structure:hover {
            box-shadow: 2px 2px 8px -4px #000;
            transition: 0.2s;
        }

        #top-level-diagram {
            position: absolute;
            top: 0;
            left: 0;
        }

        #top-level-diagram>div {
            position: absolute;
        }

        #container {
            position: absolute;
        }
    </style>
</body>

</html>